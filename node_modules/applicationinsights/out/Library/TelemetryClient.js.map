{"version":3,"file":"TelemetryClient.js","sourceRoot":"","sources":["../../Library/TelemetryClient.ts"],"names":[],"mappings":"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","sourcesContent":["import url = require(\"url\");\r\nimport os = require(\"os\");\r\nimport azureCore = require(\"@azure/core-http\");\r\n\r\nimport Config = require(\"./Config\");\r\nimport AuthorizationHandler = require(\"./AuthorizationHandler\");\r\nimport Context = require(\"./Context\");\r\nimport Contracts = require(\"../Declarations/Contracts\");\r\nimport Channel = require(\"./Channel\");\r\nimport TelemetryProcessors = require(\"../TelemetryProcessors\");\r\nimport { CorrelationContextManager } from \"../AutoCollection/CorrelationContextManager\";\r\nimport Statsbeat = require(\"../AutoCollection/Statsbeat\");\r\nimport Sender = require(\"./Sender\");\r\nimport Util = require(\"./Util\");\r\nimport Logging = require(\"./Logging\");\r\nimport FlushOptions = require(\"./FlushOptions\");\r\nimport EnvelopeFactory = require(\"./EnvelopeFactory\");\r\nimport QuickPulseStateManager = require(\"./QuickPulseStateManager\");\r\nimport { Tags } from \"../Declarations/Contracts\";\r\n\r\n/**\r\n * Application Insights telemetry client provides interface to track telemetry items, register telemetry initializers and\r\n * and manually trigger immediate sending (flushing)\r\n */\r\nclass TelemetryClient {\r\n    private static TAG = \"TelemetryClient\";\r\n    private _telemetryProcessors: { (envelope: Contracts.EnvelopeTelemetry, contextObjects: { [name: string]: any; }): boolean; }[] = [];\r\n    private _enableAzureProperties: boolean = false;\r\n    private _statsbeat: Statsbeat;\r\n\r\n    public config: Config;\r\n    public context: Context;\r\n    public commonProperties: { [key: string]: string; };\r\n    public channel: Channel;\r\n    public quickPulseClient: QuickPulseStateManager;\r\n    public authorizationHandler: AuthorizationHandler;\r\n\r\n    /**\r\n     * Constructs a new client of the client\r\n     * @param setupString the Connection String or Instrumentation Key to use (read from environment variable if not specified)\r\n     */\r\n    constructor(setupString?: string) {\r\n        var config = new Config(setupString);\r\n        this.config = config;\r\n        this.context = new Context();\r\n        this.commonProperties = {};\r\n        this.authorizationHandler = null;\r\n        if (!this.config.disableStatsbeat) {\r\n            this._statsbeat = new Statsbeat(this.config, this.context);\r\n            this._statsbeat.enable(true);\r\n        }\r\n        var sender = new Sender(this.config, this.getAuthorizationHandler, null, null, this._statsbeat);\r\n        this.channel = new Channel(() => config.disableAppInsights, () => config.maxBatchSize, () => config.maxBatchIntervalMs, sender);\r\n    }\r\n\r\n    /**\r\n     * Log information about availability of an application\r\n     * @param telemetry      Object encapsulating tracking options\r\n     */\r\n    public trackAvailability(telemetry: Contracts.AvailabilityTelemetry): void {\r\n        this.track(telemetry, Contracts.TelemetryType.Availability);\r\n    }\r\n\r\n    /**\r\n     * Log a page view\r\n     * @param telemetry      Object encapsulating tracking options\r\n     */\r\n    public trackPageView(telemetry: Contracts.PageViewTelemetry): void {\r\n        this.track(telemetry, Contracts.TelemetryType.PageView);\r\n    }\r\n\r\n    /**\r\n     * Log a trace message\r\n     * @param telemetry      Object encapsulating tracking options\r\n     */\r\n    public trackTrace(telemetry: Contracts.TraceTelemetry): void {\r\n        this.track(telemetry, Contracts.TelemetryType.Trace);\r\n    }\r\n\r\n    /**\r\n     * Log a numeric value that is not associated with a specific event. Typically used to send regular reports of performance indicators.\r\n     * To send a single measurement, use just the first two parameters. If you take measurements very frequently, you can reduce the\r\n     * telemetry bandwidth by aggregating multiple measurements and sending the resulting average at intervals.\r\n     * @param telemetry      Object encapsulating tracking options\r\n     */\r\n    public trackMetric(telemetry: Contracts.MetricTelemetry): void {\r\n        this.track(telemetry, Contracts.TelemetryType.Metric);\r\n    }\r\n\r\n    /**\r\n     * Log an exception\r\n     * @param telemetry      Object encapsulating tracking options\r\n     */\r\n    public trackException(telemetry: Contracts.ExceptionTelemetry): void {\r\n        if (telemetry && telemetry.exception && !Util.isError(telemetry.exception)) {\r\n            telemetry.exception = new Error(telemetry.exception.toString());\r\n        }\r\n        this.track(telemetry, Contracts.TelemetryType.Exception);\r\n    }\r\n\r\n    /**\r\n     * Log a user action or other occurrence.\r\n     * @param telemetry      Object encapsulating tracking options\r\n     */\r\n    public trackEvent(telemetry: Contracts.EventTelemetry): void {\r\n        this.track(telemetry, Contracts.TelemetryType.Event);\r\n    }\r\n\r\n    /**\r\n     * Log a request. Note that the default client will attempt to collect HTTP requests automatically so only use this for requests\r\n     * that aren't automatically captured or if you've disabled automatic request collection.\r\n     *\r\n     * @param telemetry      Object encapsulating tracking options\r\n     */\r\n    public trackRequest(telemetry: Contracts.RequestTelemetry & Contracts.Identified): void {\r\n        this.track(telemetry, Contracts.TelemetryType.Request);\r\n    }\r\n\r\n    /**\r\n     * Log a dependency. Note that the default client will attempt to collect dependencies automatically so only use this for dependencies\r\n     * that aren't automatically captured or if you've disabled automatic dependency collection.\r\n     *\r\n     * @param telemetry      Object encapsulating tracking option\r\n     * */\r\n    public trackDependency(telemetry: Contracts.DependencyTelemetry & Contracts.Identified) {\r\n\r\n        if (telemetry && !telemetry.target && telemetry.data) {\r\n            // url.parse().host returns null for non-urls,\r\n            // making this essentially a no-op in those cases\r\n            // If this logic is moved, update jsdoc in DependencyTelemetry.target\r\n            // url.parse() is deprecated, update to use WHATWG URL API instead\r\n            try {\r\n                telemetry.target = new url.URL(telemetry.data).host;\r\n            } catch (error) {\r\n                // set target as null to be compliant with previous behavior\r\n                telemetry.target = null;\r\n                Logging.warn(TelemetryClient.TAG, \"The URL object is failed to create.\", error);\r\n            }\r\n        }\r\n        this.track(telemetry, Contracts.TelemetryType.Dependency);\r\n    }\r\n\r\n    /**\r\n     * Immediately send all queued telemetry.\r\n     * @param options Flush options, including indicator whether app is crashing and callback\r\n     */\r\n    public flush(options?: FlushOptions) {\r\n        this.channel.triggerSend(\r\n            options ? !!options.isAppCrashing : false,\r\n            options ? options.callback : undefined);\r\n    }\r\n\r\n    /**\r\n     * Generic track method for all telemetry types\r\n     * @param data the telemetry to send\r\n     * @param telemetryType specify the type of telemetry you are tracking from the list of Contracts.DataTypes\r\n     */\r\n    public track(telemetry: Contracts.Telemetry, telemetryType: Contracts.TelemetryType) {\r\n        if (telemetry && Contracts.telemetryTypeToBaseType(telemetryType)) {\r\n            var envelope = EnvelopeFactory.createEnvelope(telemetry, telemetryType, this.commonProperties, this.context, this.config);\r\n\r\n            // Set time on the envelope if it was set on the telemetry item\r\n            if (telemetry.time) {\r\n                envelope.time = telemetry.time.toISOString();\r\n            }\r\n            if (this._enableAzureProperties) {\r\n                TelemetryProcessors.azureRoleEnvironmentTelemetryProcessor(envelope, this.context);\r\n            }\r\n            var accepted = this.runTelemetryProcessors(envelope, telemetry.contextObjects);\r\n\r\n            // Ideally we would have a central place for \"internal\" telemetry processors and users can configure which ones are in use.\r\n            // This will do for now. Otherwise clearTelemetryProcessors() would be problematic.\r\n            accepted = accepted && TelemetryProcessors.samplingTelemetryProcessor(envelope, { correlationContext: CorrelationContextManager.getCurrentContext() });\r\n            TelemetryProcessors.preAggregatedMetricsTelemetryProcessor(envelope, this.context);\r\n            if (accepted) {\r\n                TelemetryProcessors.performanceMetricsTelemetryProcessor(envelope, this.quickPulseClient);\r\n                this.channel.send(envelope);\r\n            }\r\n        }\r\n        else {\r\n            Logging.warn(TelemetryClient.TAG, \"track() requires telemetry object and telemetryType to be specified.\")\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Automatically populate telemetry properties like RoleName when running in Azure\r\n     *\r\n      * @param value if true properties will be populated\r\n     */\r\n    public setAutoPopulateAzureProperties(value: boolean) {\r\n        this._enableAzureProperties = value;\r\n    }\r\n\r\n    /**\r\n     * Get Authorization handler\r\n     */\r\n    public getAuthorizationHandler(config: Config): AuthorizationHandler {\r\n        if (config && config.aadTokenCredential) {\r\n            if (!this.authorizationHandler) {\r\n                Logging.info(TelemetryClient.TAG, \"Adding authorization handler\");\r\n                this.authorizationHandler = new AuthorizationHandler(config.aadTokenCredential)\r\n            }\r\n            return this.authorizationHandler;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Adds telemetry processor to the collection. Telemetry processors will be called one by one\r\n     * before telemetry item is pushed for sending and in the order they were added.\r\n     *\r\n     * @param telemetryProcessor function, takes Envelope, and optional context object and returns boolean\r\n     */\r\n    public addTelemetryProcessor(telemetryProcessor: (envelope: Contracts.EnvelopeTelemetry, contextObjects?: { [name: string]: any; }) => boolean) {\r\n        this._telemetryProcessors.push(telemetryProcessor);\r\n    }\r\n\r\n    /*\r\n     * Removes all telemetry processors\r\n     */\r\n    public clearTelemetryProcessors() {\r\n        this._telemetryProcessors = [];\r\n    }\r\n\r\n    private runTelemetryProcessors(envelope: Contracts.EnvelopeTelemetry, contextObjects: { [name: string]: any; }): boolean {\r\n        var accepted = true;\r\n        var telemetryProcessorsCount = this._telemetryProcessors.length;\r\n\r\n        if (telemetryProcessorsCount === 0) {\r\n            return accepted;\r\n        }\r\n\r\n        contextObjects = contextObjects || {};\r\n        contextObjects['correlationContext'] = CorrelationContextManager.getCurrentContext();\r\n\r\n        for (var i = 0; i < telemetryProcessorsCount; ++i) {\r\n            try {\r\n                var processor = this._telemetryProcessors[i];\r\n                if (processor) {\r\n                    if (processor.apply(null, [envelope, contextObjects]) === false) {\r\n                        accepted = false;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n            } catch (error) {\r\n                accepted = true;\r\n                Logging.warn(TelemetryClient.TAG, \"One of telemetry processors failed, telemetry item will be sent.\", error, envelope);\r\n            }\r\n        }\r\n\r\n        // Sanitize tags and properties after running telemetry processors\r\n        if (accepted) {\r\n            if (envelope && envelope.tags) {\r\n                envelope.tags = Util.validateStringMap(envelope.tags) as Tags & Tags[];\r\n            }\r\n            if (envelope && envelope.data && envelope.data.baseData && envelope.data.baseData.properties) {\r\n                envelope.data.baseData.properties = Util.validateStringMap(envelope.data.baseData.properties);\r\n            }\r\n        }\r\n\r\n        return accepted;\r\n    }\r\n\r\n    /*\r\n     * Get Statsbeat instance\r\n     */\r\n    public getStatsbeat() {\r\n        return this._statsbeat;\r\n    }\r\n}\r\n\r\nexport = TelemetryClient;"]}