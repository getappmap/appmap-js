{"version":3,"file":"DiagnosticLogger.js","sourceRoot":"","sources":["../../Bootstrap/DiagnosticLogger.ts"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;;;;;;;;;;;AAEb,2BAA6B;AAE7B,2CAA0C;AAC1C,qDAAgD;AAChD,uDAA6E;AAE7E;IAmBI,0BAAoB,OAAwC;QAAxC,wBAAA,EAAA,iBAAwC;QAAxC,YAAO,GAAP,OAAO,CAAiC;IAAI,CAAC;IAEjE,qCAAU,GAAV,UAAW,OAAyC,EAAE,EAAyB;QAC3E,IAAI,OAAO,EAAE,KAAK,UAAU,IAAI,IAAI,CAAC,OAAO,YAAY,uBAAU,EAAE;YAChE,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,EAAE,CAAC;SAC9B;QACD,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE;YAC7B,IAAM,iBAAiB,yBAChB,gBAAgB,CAAC,eAAe,KACnC,OAAO,SAAA,EACP,KAAK,qBACL,IAAI,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,GACjC,CAAC;YACF,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;SACvC;aAAM;YACH,IAAI,OAAO,CAAC,KAAK,wBAAkC,EAAE;gBACjD,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;aAC/B;iBAAM;gBACH,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;aAC7B;SACJ;IACL,CAAC;IAED,mCAAQ,GAAR,UAAS,OAAyC,EAAE,EAAyB;QACzE,IAAI,OAAO,EAAE,KAAK,UAAU,IAAI,IAAI,CAAC,OAAO,YAAY,uBAAU,EAAE;YAChE,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,EAAE,CAAC;SAC9B;QACD,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE;YAC7B,IAAM,iBAAiB,yBAChB,gBAAgB,CAAC,eAAe,KACnC,OAAO,SAAA,EACP,KAAK,uBACL,IAAI,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,GACjC,CAAC;YACF,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC;SACzC;aAAM;YACH,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;SAC/B;IACL,CAAC;IAxDsB,kCAAiB,GAAW,oCAAoC,CAAC;IACjE,gCAAe,GAAW,OAAO,CAAC,GAAG,CAAC,0BAA0B,IAAI,IAAI,CAAC,IAAI,CAAC,qBAAO,EAAE,8BAA8B,CAAC,CAAC;IAChI,gCAAe,GAA4B;QACrD,OAAO,EAAE,IAAI;QACb,KAAK,EAAE,IAAI;QACX,IAAI,EAAE,IAAI;QACV,MAAM,EAAE,2CAA2C;QACnD,UAAU,EAAE;YACR,QAAQ,EAAE,QAAQ;YAClB,SAAS,EAAE,SAAS;YACpB,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,iBAAiB;YACvC,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,8BAA8B;YAChD,gBAAgB,EAAE,OAAO,CAAC,GAAG,CAAC,0CAA0C;YACxE,UAAU,EAAE,4CAAgC;YAC5C,cAAc,EAAE,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI;SACvG;KACJ,CAAA;IAyCL,uBAAC;CAAA,AA1DD,IA0DC;AA1DY,4CAAgB","sourcesContent":["\"use strict\";\r\n\r\nimport * as path from \"path\";\r\nimport * as DataModel from \"./DataModel\";\r\nimport { FileWriter } from \"./FileWriter\";\r\nimport { homedir } from \"./Helpers/FileHelpers\";\r\nimport { APPLICATION_INSIGHTS_SDK_VERSION } from \"../Declarations/Constants\";\r\n\r\nexport class DiagnosticLogger {\r\n    public static readonly DEFAULT_FILE_NAME: string = \"application-insights-extension.log\";\r\n    public static readonly DEFAULT_LOG_DIR: string = process.env.APPLICATIONINSIGHTS_LOGDIR || path.join(homedir, \"LogFiles/ApplicationInsights\");\r\n    public static DefaultEnvelope: DataModel.DiagnosticLog = {\r\n        message: null,\r\n        level: null,\r\n        time: null,\r\n        logger: \"applicationinsights.extension.diagnostics\",\r\n        properties: {\r\n            language: \"nodejs\",\r\n            operation: \"Startup\",\r\n            siteName: process.env.WEBSITE_SITE_NAME,\r\n            ikey: process.env.APPINSIGHTS_INSTRUMENTATIONKEY,\r\n            extensionVersion: process.env.ApplicationInsightsAgent_EXTENSION_VERSION,\r\n            sdkVersion: APPLICATION_INSIGHTS_SDK_VERSION,\r\n            subscriptionId: process.env.WEBSITE_OWNER_NAME ? process.env.WEBSITE_OWNER_NAME.split(\"+\")[0] : null,\r\n        }\r\n    }\r\n\r\n    constructor(private _writer: DataModel.AgentLogger = console) { }\r\n\r\n    logMessage(message: DataModel.DiagnosticLog | string, cb?: (err: Error) => void) {\r\n        if (typeof cb === \"function\" && this._writer instanceof FileWriter) {\r\n            this._writer.callback = cb;\r\n        }\r\n        if (typeof message === \"string\") {\r\n            const diagnosticMessage: DataModel.DiagnosticLog = {\r\n                ...DiagnosticLogger.DefaultEnvelope,\r\n                message,\r\n                level: DataModel.SeverityLevel.INFO,\r\n                time: new Date().toISOString(),\r\n            };\r\n            this._writer.log(diagnosticMessage);\r\n        } else {\r\n            if (message.level === DataModel.SeverityLevel.ERROR) {\r\n                this._writer.error(message);\r\n            } else {\r\n                this._writer.log(message);\r\n            }\r\n        }\r\n    }\r\n\r\n    logError(message: DataModel.DiagnosticLog | string, cb?: (err: Error) => void) {\r\n        if (typeof cb === \"function\" && this._writer instanceof FileWriter) {\r\n            this._writer.callback = cb;\r\n        }\r\n        if (typeof message === \"string\") {\r\n            const diagnosticMessage: DataModel.DiagnosticLog = {\r\n                ...DiagnosticLogger.DefaultEnvelope,\r\n                message,\r\n                level: DataModel.SeverityLevel.ERROR,\r\n                time: new Date().toUTCString()\r\n            };\r\n            this._writer.error(diagnosticMessage);\r\n        } else {\r\n            this._writer.error(message);\r\n        }\r\n    }\r\n}\r\n"]}